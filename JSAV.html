<html>
<head>
<title>SOG_alignment</title>

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.PNG">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.PNG">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.PNG">
  <link rel="manifest" href="/site.webmanifest">	
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico?">

<!-- JQuery and JQuery-UI -->
<link href="scripts/jquery.css" rel="stylesheet" />
<script type='text/javascript' src='scripts/jquery-1.10.2.min.js'></script>
<script type='text/javascript' src='scripts//jquery-ui-1.10.4.custom.min.js'></script>

<!-- JSAV -->
<link href="scripts/JSAV.css" rel="stylesheet" />
<script type='text/javascript' src='scripts/JSAV.js'></script>

<!-- If using tooltipster -->
<link href="scripts/tooltipster-master/css/tooltipster.css" rel="stylesheet" />
<script type='text/javascript' src='scripts/tooltipster-master/js/jquery.tooltipster.min.js'></script>
<script>
function enableTooltipster()
{
   $(document).ready(function() {
       $('.tooltip').tooltipster();
   });
}
enableTooltipster();
</script>
<!-- END -->

    <script>
        function goBack() {
            window.location.href = "https://fsnibs10.github.io/SOG/SOG_table.html";
        }
    </script>
    <script>
    function goUpper() {
    window.history.back();
    }
    </script>



</head>
<body>

<button onclick="goBack()">Back to SOG table</button>
<button onclick="goUpper()">Back to SOG page</button>
<br>
<br>


<script type='text/javascript'>

function alignmentTxtFileToObjectArray(fileAddress) {
    // 通过AJAX同步请求获取文件内容
    let txtObj = $.ajax({ url: fileAddress, async: false });
    // 以 '>' 分割文件内容，获取每个FASTA条目的片段
    let txtObjArray = txtObj.responseText.split(/>/);
    let ObjArray = [];

    // 从第二个元素开始遍历，因为第一个元素为空
    for (let i = 1; i < txtObjArray.length; i++) {
        // 以换行符分割当前FASTA条目的片段
        let temp = txtObjArray[i].split(/\r?\n/);
        // 第一个元素是序列的ID
        let id = temp[0];
        // 从第二个元素开始，将所有行合并成一个完整的序列
        let sequence = temp.slice(1).join('');
        // 将ID和序列组合成一个对象，并添加到结果数组中
        ObjArray.push({ id: id, sequence: sequence });
    }
    return ObjArray;
}



const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');
const dataFilePath = `protein_einsi_alignment/${id}.AA.einsi.fasta`;
const dataFilePathAll = `human_Sc/${id}.AA.einsi.fasta`;

var MySeqs = alignmentTxtFileToObjectArray(dataFilePath)
var MySeqs2 = alignmentTxtFileToObjectArray(dataFilePathAll)
</script>



<ul><li><p style="font-size: 20px;">Protein alignment for SOG genes</p></li></ul>

<div id='sequenceDisplay'>
</div>

<!-- optional display box for the ungapped coordinate -->
<div id="coordBox" style="margin-top:8px;font-family:sans-serif;">Click a residue</div>


<script type='text/javascript'>
var opts = Array();
opts.sortable = true;
opts.selectable = true;
opts.deletable = true;
opts.border = false;
opts.toggleDotify = true;
opts.toggleNocolour = true;
opts.fasta = true;
opts.consensus = true;
opts.colourScheme = "zappo";
opts.selectColour = true;
opts.callback = "enableTooltipster";

function myAction(divId, sequences)
{
   var seqString = "";
   for(var i=0; i<sequences.length; i++)
   {
       seqString += ">" + sequences[i].id + "\n";
       seqString += sequences[i].sequence + "\n";
   }
   alert(seqString);
}

var MyOptions = Array();
MyOptions.sortable = true;
MyOptions.selectable = true;
MyOptions.deletable = true;
MyOptions.scrollX = "100%";
MyOptions.scrollY = "800px";
MyOptions.highlight = [24,34];

MyOptions.toggleDotify = true;
MyOptions.toggleNocolour = true;
MyOptions.fasta = true;
MyOptions.consensus = true;
MyOptions.colourScheme = "zappo";
MyOptions.selectColour = true;
MyOptions.callback = "enableTooltipster";

MyOptions.idSubmit = "http://www.bioinf.org.uk/software/jsav/echo.cgi?seq=";
MyOptions.idSubmitClean = true;

MyOptions.labels = JSAV_autoLabels(MySeqs);
printJSAV('sequenceDisplay', MySeqs, MyOptions);

// Hover-enabled residue coordinate display for JSAV (replaces the click-based handler)
(function() {
  var container = document.getElementById('sequenceDisplay');
  if (!container) return;

  var coordBox = document.getElementById('coordBox');
  if (!coordBox) {
    // create if missing
    coordBox = document.createElement('div');
    coordBox.id = 'coordBox';
    coordBox.style.marginTop = '8px';
    coordBox.style.fontFamily = 'sans-serif';
    container.parentNode.insertBefore(coordBox, container.nextSibling);
  }

  var DEFAULT_MSG = 'Hover the mouse over a residue to display the coordinate of the amino acid';
  var gapChars = ['-','.']; // adjust if you want '.' to count as residues
  coordBox.textContent = DEFAULT_MSG;

  // helper to test whether an element looks like a residue cell
  function isResidueCell(el) {
    if (!el || el.nodeType !== 1) return false;
    var txt = (el.textContent || '').trim();
    return txt.length === 1 && /^[A-Za-z.\-]$/.test(txt);
  }

  var lastSeenCell = null;

  function showForCell(cell, ev) {
    if (!cell || cell === lastSeenCell) return;
    lastSeenCell = cell;

    // find row
    var row = cell.parentElement;
    if (!row) return;

    var children = Array.prototype.slice.call(row.children);

    // identify residue cells in this row by heuristic (single-character cells)
    var residueCells = children.filter(function(td) {
      var txt = (td.textContent || '').trim();
      return txt.length === 1 && /^[A-Za-z.\-]$/.test(txt);
    });

    if (residueCells.length === 0) return;

    // find column index
    var colIndex = residueCells.indexOf(cell);
    if (colIndex === -1) {
      for (var i = 0; i < residueCells.length; i++) {
        if (residueCells[i].contains(cell)) { colIndex = i; cell = residueCells[i]; break; }
      }
    }
    if (colIndex === -1) return;

    // build visible sequence string for the row
    var seqArr = residueCells.map(function(td) { return (td.textContent || '').trim().charAt(0) || '-'; });
    var seqStr = seqArr.join('');

    // compute ungapped position (1-based) up to and including colIndex
    var ungappedCount = 0;
    for (var k = 0; k <= colIndex; k++) {
      var ch = seqStr.charAt(k);
      var isGap = gapChars.indexOf(ch) !== -1;
      if (!isGap) ungappedCount++;
    }
    var ungappedPos = ungappedCount; // may be 0 if all gaps up to clicked column

    // get sequence id / name from the row (best-effort)
    var name = null;
    var idCell = row.querySelector('.idCell, .id, th, td');
    if (idCell) {
      // prefer leftmost non-residue cell as id if it's before residue cells
      // find first child that is not one of the residueCells
      for (var j = 0; j < children.length; j++) {
        if (residueCells.indexOf(children[j]) === -1) {
          var candidate = (children[j].textContent || '').trim();
          if (candidate.length > 0) { name = candidate; break; }
        }
      }
    }
    if (!name) name = 'Sequence';

    // update display: "Gene2: amino acid 3"
    var posText = ungappedPos > 0 ? ungappedPos : '-';
    coordBox.textContent = name + ': amino acid ' + posText;
  }

  function resetDisplay() {
    lastSeenCell = null;
    coordBox.textContent = DEFAULT_MSG;
  }

  // Use mousemove to track current element below cursor; mouseleave resets the display.
  container.addEventListener('mousemove', function(ev) {
    var el = ev.target;
    // find the closest residue-like element up the chain but not beyond container
    while (el && el !== container && !isResidueCell(el)) {
      el = el.parentElement;
    }
    if (el && el !== container && isResidueCell(el)) {
      showForCell(el, ev);
    } else {
      // if cursor not on a residue cell, reset the display
      if (lastSeenCell) resetDisplay();
    }
  });

  container.addEventListener('mouseleave', function() {
    resetDisplay();
  });

})();


</script>
<br>

<!-- 灰色分隔线------------------------------- -->
<hr style="border: 0; height: 1px; background: #ccc; margin: 10px 0;">
<ul><li><p style="font-size: 20px;">Protein alignment including the ortholog sequences from human or <em>Saccharomyces cerevisiae</em></p></li></ul>

<div id='sequenceDisplay2'>
</div>

<!-- optional display box for the ungapped coordinate -->
<div id="coordBox2" style="margin-top:8px;font-family:sans-serif;">Click a residue</div>


<script type='text/javascript'>
var opts = Array();
opts.sortable = true;
opts.selectable = true;
opts.deletable = true;
opts.border = false;
opts.toggleDotify = true;
opts.toggleNocolour = true;
opts.fasta = true;
opts.consensus = true;
opts.colourScheme = "zappo";
opts.selectColour = true;
opts.callback = "enableTooltipster";

function myAction(divId, sequences)
{
   var seqString = "";
   for(var i=0; i<sequences.length; i++)
   {
       seqString += ">" + sequences[i].id + "\n";
       seqString += sequences[i].sequence + "\n";
   }
   alert(seqString);
}

var MyOptions2 = Array();
MyOptions2.sortable = true;
MyOptions2.selectable = true;
MyOptions2.deletable = true;
MyOptions2.scrollX = "100%";
MyOptions2.scrollY = "800px";
MyOptions2.highlight = [24,34];

MyOptions2.toggleDotify = true;
MyOptions2.toggleNocolour = true;
MyOptions2.fasta = true;
MyOptions2.consensus = true;
MyOptions2.colourScheme = "zappo";
MyOptions2.selectColour = true;
MyOptions2.callback = "enableTooltipster";

MyOptions2.idSubmit = "http://www.bioinf.org.uk/software/jsav/echo.cgi?seq=";
MyOptions2.idSubmitClean = true;
MyOptions2.labels = JSAV_autoLabels(MySeqs2);
printJSAV('sequenceDisplay2', MySeqs2, MyOptions2);

// Hover-enabled residue coordinate display for JSAV (replaces the click-based handler)
(function() {
  var container = document.getElementById('sequenceDisplay2');
  if (!container) return;

  var coordBox = document.getElementById('coordBox2');
  if (!coordBox) {
    // create if missing
    coordBox = document.createElement('div');
    coordBox.id = 'coordBox2';
    coordBox.style.marginTop = '8px';
    coordBox.style.fontFamily = 'sans-serif';
    container.parentNode.insertBefore(coordBox, container.nextSibling);
  }

  var DEFAULT_MSG = 'Hover the mouse over a residue to display the coordinate of the amino acid';
  var gapChars = ['-','.']; // adjust if you want '.' to count as residues
  coordBox.textContent = DEFAULT_MSG;

  // helper to test whether an element looks like a residue cell
  function isResidueCell(el) {
    if (!el || el.nodeType !== 1) return false;
    var txt = (el.textContent || '').trim();
    return txt.length === 1 && /^[A-Za-z.\-]$/.test(txt);
  }

  var lastSeenCell = null;

  function showForCell(cell, ev) {
    if (!cell || cell === lastSeenCell) return;
    lastSeenCell = cell;

    // find row
    var row = cell.parentElement;
    if (!row) return;

    var children = Array.prototype.slice.call(row.children);

    // identify residue cells in this row by heuristic (single-character cells)
    var residueCells = children.filter(function(td) {
      var txt = (td.textContent || '').trim();
      return txt.length === 1 && /^[A-Za-z.\-]$/.test(txt);
    });

    if (residueCells.length === 0) return;

    // find column index
    var colIndex = residueCells.indexOf(cell);
    if (colIndex === -1) {
      for (var i = 0; i < residueCells.length; i++) {
        if (residueCells[i].contains(cell)) { colIndex = i; cell = residueCells[i]; break; }
      }
    }
    if (colIndex === -1) return;

    // build visible sequence string for the row
    var seqArr = residueCells.map(function(td) { return (td.textContent || '').trim().charAt(0) || '-'; });
    var seqStr = seqArr.join('');

    // compute ungapped position (1-based) up to and including colIndex
    var ungappedCount = 0;
    for (var k = 0; k <= colIndex; k++) {
      var ch = seqStr.charAt(k);
      var isGap = gapChars.indexOf(ch) !== -1;
      if (!isGap) ungappedCount++;
    }
    var ungappedPos = ungappedCount; // may be 0 if all gaps up to clicked column

    // get sequence id / name from the row (best-effort)
    var name = null;
    var idCell = row.querySelector('.idCell, .id, th, td');
    if (idCell) {
      // prefer leftmost non-residue cell as id if it's before residue cells
      // find first child that is not one of the residueCells
      for (var j = 0; j < children.length; j++) {
        if (residueCells.indexOf(children[j]) === -1) {
          var candidate = (children[j].textContent || '').trim();
          if (candidate.length > 0) { name = candidate; break; }
        }
      }
    }
    if (!name) name = 'Sequence';

    // update display: "Gene2: amino acid 3"
    var posText = ungappedPos > 0 ? ungappedPos : '-';
    coordBox.textContent = name + ': amino acid ' + posText;
  }

  function resetDisplay() {
    lastSeenCell = null;
    coordBox.textContent = DEFAULT_MSG;
  }

  // Use mousemove to track current element below cursor; mouseleave resets the display.
  container.addEventListener('mousemove', function(ev) {
    var el = ev.target;
    // find the closest residue-like element up the chain but not beyond container
    while (el && el !== container && !isResidueCell(el)) {
      el = el.parentElement;
    }
    if (el && el !== container && isResidueCell(el)) {
      showForCell(el, ev);
    } else {
      // if cursor not on a residue cell, reset the display
      if (lastSeenCell) resetDisplay();
    }
  });

  container.addEventListener('mouseleave', function() {
    resetDisplay();
  });

})();




</script>
<br>


</body>
</html>
